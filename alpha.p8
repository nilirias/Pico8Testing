pico-8 cartridge // http://www.pico-8.com
version 36
__lua__
--variables--

function _init()
	p={
	sp=1,
	x=59,
	y=59,
	w=8,
	h=8,
	flp=false,
	
	dx=0,
	dy=0,
	max_dx=2,
	max_dy=3,
	acc = 0.5,
	--boost = 4,
	
	anim = 0,
	running = false,
	jumping = false,
	landed = true,
	idle = true,
	falling = false
	}
	
	gravity=0.3
	friction=0.85
	boost=4
end
-->8
--update and draw

function _update()
	p_update()
 p_anim()
end

function _draw()
	cls()
	map(0,0)
	spr(p.sp, p.x, p.y, 1,1,p.flp)
end
-->8
--collision

function collide_map(obj, aim, flag)
	local x=obj.x	local y=obj.y
	local h=obj.h	local w=obj.w
	
	local x1=0	local y1=0
	local x2=0	local y2=0
	
	if aim=="left" then
		x1=x-1	y1=y
		x2=x			y2=y+h-1
	
	elseif aim=="right" then
		x1=x+w			y1=y
		x2=x+w+1	y2=y+h-1
		
	elseif aim=="up" then
		x1=x+1			y1=y-1
		x2=x+w-1	y2=y
		
	elseif aim=="down" then
		x1=x			y1=y+h
		x2=x+w	y2=y+h
	end
	
	--pixels to tiles
	x1/=8	y1/=8
	x2/=8	y2/=8
	
	if fget(mget(x1,y1), flag)
	or fget(mget(x1,y2), flag)
	or fget(mget(x2,y1), flag)
	or fget(mget(x2,y2), flag) then
		return true
	else
		return 
	end
	
end
-->8
--player functions

function p_update()
	p.dy += gravity
	p.dx *= friction
	
	--caminar
	if btn(⬅️) then
		p.dx-=p.acc
		p.running=true
		p.flp=true
	end
	
	if btn(➡️) then
		p.dx+=p.acc
		p.running=true
		p.flp=false
	end
	
	--saltar
	if btn(⬆️)
	and p.landed then
		p.dy-=boost
		p.landed=false
	end
	
	--check collision
	if p.dy>0 then
		p.falling=true
		p.landed=false
		p.jumping=false
		
		p.dy=mid(-p.max_dy,p.dy,p.max_dy)
		
		if collide_map(p,"down",0) then
			p.landed=true
			p.falling=false
			p.dy=0
			p.y-=(p.y+p.h)%8
		end
		
	elseif p.dy<0 then
		p.jumping=true
		
		if collide_map(p,"up",0) then
			p.dy=0
		end
	end
	
	if p.dx<0 then
	p.dx=mid(-p.max_dx,p.dx,p.max_dx)
	end
		
	--check ladder
	--if collide_map(p,"up" or "down",1)then
	--	p.landed=true
		--p.falling=false
		--p.jumping=true
		--p.dy=0
	--end
	
	p.x+=p.dx
	p.y+=p.dy
	
end

function p_anim()
	if p.running then
		if time()-p.anim>.1 then
			p.anim=time()
			p.sp+=1
			if p.sp > 5 then
				p.sp=2
			end
		end
	elseif p.jumping then
		p.sp=6
	else
		p.sp=1
	end
end

__gfx__
0000000000c7c7c000c7c7c000c7c7c000c7c7c000c7c7c0000000000077c7700000000000000000000000000000000000000000000000000000000000000000
0000000000c7c7c000c7c7c000c7c7c000c7c7c000c7c7c00000000000c777c00000000000000000000000000000000000000000000000000000000000000000
0070070000c777c000c777c000c777c000c777c000c777c00077c77000c787800000000000000000000000000000000000000000000000000000000000000000
0007700000c7878000c7878000c7878000c7878000c7878000c777c0000eee000000000000000000000000000000000000000000000000000000000000000000
00077000000eee00000eee00000eee00000eee00000eee0000c7878007eeeee00000000000000000000000000000000000000000000000000000000000000000
0070070007eeeee007eeeee007eeeee007eeeee007eeeee0000eee00000706000000000000000000000000000000000000000000000000000000000000000000
00000000000706000007060000076000000607000006700007eeeee0000706000000000000000000000000000000000000000000000000000000000000000000
00000000000706000070060000076000006007000006700000070600000000000000000000000000000000000000000000000000000000000000000000000000
11111111010000101111111111111111111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
11111111011111100100001001000010010000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000010000100111111001111110011111100000001001000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000011111100100001001000000000000100011111001111100000000100000000000000000000000000000000000000000000000000000000000000000
00000000010000100111111001111000000111100000001001000000001111100000000000000000000000000000000000000000000000000000000000000000
00000000011111100100001001000000000000100111111001111110000000100000000000000000000000000000000000000000000000000000000000000000
00000000010000100111111000000000000000000100001001000010011111100000000000000000000000000000000000000000000000000000000000000000
00000000011111100100001000000000000000000111111001111110010000100000000000000000000000000000000000000000000000000000000000000000
01000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
11111111111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
11111111001000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00100010001000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00100010001000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00100010001000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000000000000000000000000000001000001010000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2121000000000000000000000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1310000000000000000000000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000002121212121210000000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000001010101310100000000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000021212121212120212100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000001500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000001100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000002121212021000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000161010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2121202121212121000021210000212100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010100000101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
